is_troll := {
	card.card_type == "mutantblood troll" or
	card.card_type == "peasantblood troll" or
	card.card_type == "midblood troll" or
	card.card_type == "highblood troll" or
	card.card_type == "seablood troll"
}


is_character := {
	is_troll() or
	card.card_type == "human"
}

text_filter := 
		# step 1 : remove all automatic tags
		tag_remove_rule(tag: "<sym-auto>") +
		# step 2 : expand shortcut words ~ and CARDNAME
		replace_rule(
			match: "CARDNAME",
			in_context: "(^|[[:space:]]|\\()<match>", # TODO: Allow any punctuation before
			replace: "<atom-cardname></atom-cardname>"
			) +
		# step 3 : fill in the cardname atom field
		tag_contents_rule(
			tag: "<atom-cardname>",
			contents: { if card.name=="" then "CARDNAME" else card.name }
			) +
		# step 4 : symbols
		replace_rule(
			match: "\\[I>",
			replace: "<sym-auto>I</sym-auto>" );